<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Add Cashflow</title>
    <script>
        function toggleCategoryDropdown() {
            var typeSelect = document.getElementById('type');
            var incomeCatDiv = document.getElementById('incomeCategoryDiv');
            var expenseCatDiv = document.getElementById('expenseCategoryDiv');

            if (typeSelect.value === 'INCOME') {
                incomeCatDiv.style.display = 'block';
                expenseCatDiv.style.display = 'none';
            } else if (typeSelect.value === 'EXPENSE') {
                incomeCatDiv.style.display = 'none';
                expenseCatDiv.style.display = 'block';
            } else {
                incomeCatDiv.style.display = 'none';
                expenseCatDiv.style.display = 'none';
            }
        }

        window.onload = function() {
            toggleCategoryDropdown();
            document.getElementById('type').addEventListener('change', toggleCategoryDropdown);
        };
    </script>
</head>
<body>
<h2>Add Cashflow</h2>

<form th:action="@{/cashflow/add}" th:object="${cashflow}" method="post">
    <div>
        <label for="description">Description:</label>
        <input id="description" type="text" th:field="*{description}" required />
        <div th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></div>
    </div>

    <div>
        <label for="type">Type:</label>
        <select id="type" th:field="*{type}" required>
            <option th:each="type : ${types}"
                    th:value="${type}"
                    th:text="${type}">Type</option>
        </select>
        <div th:if="${#fields.hasErrors('type')}" th:errors="*{type}"></div>
    </div>

    <!-- Income category dropdown, visible only when type=INCOME -->
    <div id="incomeCategoryDiv" style="display:none;">
        <label for="incomeCategory">Income Category:</label>
        <select id="incomeCategory" th:field="*{incomeCategory}">
            <option th:each="cat : ${incomeCategories}"
                    th:value="${cat}"
                    th:text="${cat}">IncomeCategory</option>
        </select>
        <div th:if="${#fields.hasErrors('incomeCategory')}" th:errors="*{incomeCategory}"></div>
    </div>

    <!-- Expense category dropdown, visible only when type=EXPENSE -->
    <div id="expenseCategoryDiv" style="display:none;">
        <label for="expenseCategory">Expense Category:</label>
        <select id="expenseCategory" th:field="*{expenseCategory}">
            <option th:each="cat : ${expenseCategories}"
                    th:value="${cat}"
                    th:text="${cat}">ExpenseCategory</option>
        </select>
        <div th:if="${#fields.hasErrors('expenseCategory')}" th:errors="*{expenseCategory}"></div>
    </div>

    <div>
        <label for="amount">Amount:</label>
        <input id="amount" type="number" th:field="*{amount}" step="0.01" required />
        <div th:if="${#fields.hasErrors('amount')}" th:errors="*{amount}"></div>
    </div>

    <div>
        <label for="date">Date:</label>
        <input id="date" type="date" th:field="*{date}" required />
        <div th:if="${#fields.hasErrors('date')}" th:errors="*{date}"></div>
    </div>

    <div>
        <label for="account">Account:</label>
        <select id="account" th:field="*{account.id}" required>
            <option th:each="account : ${accounts}"
                    th:value="${account.id}"
                    th:text="${account.name} + ' (' + account.currency + ')'">
            </option>
        </select>
        <div th:if="${#fields.hasErrors('account')}" th:errors="*{account}"></div>
    </div>

    <button type="submit">Add Cashflow</button>
</form>

<p><a th:href="@{/cashflow}">Back to list</a></p>

</body>
</html>