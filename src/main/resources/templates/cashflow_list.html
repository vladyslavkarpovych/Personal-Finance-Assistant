<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Your Cashflow</title>
</head>
<body>

<h2>Your Cashflow</h2>

<form th:action="@{/cashflow}" method="get">
    <label>Type:
        <select name="type" th:onchange="this.form.submit()">
            <option value="" th:selected="${selectedType == null or selectedType == ''}">All</option>
            <option value="INCOME" th:selected="${selectedType == 'INCOME'}">INCOME</option>
            <option value="EXPENSE" th:selected="${selectedType == 'EXPENSE'}">EXPENSE</option>
        </select>
    </label>

    <label>Category:
        <select name="category">
            <option value="" th:selected="${selectedCategory == null or selectedCategory == ''}">All</option>
            <optgroup label="Income Categories" th:if="${selectedType == null or selectedType == '' or selectedType == 'INCOME'}">
                <option th:each="cat : ${incomeCategories}"
                        th:value="${cat.name()}"
                        th:text="${cat.name()}"
                        th:selected="${selectedCategory == cat.name()}">
                </option>
            </optgroup>
            <optgroup label="Expense Categories" th:if="${selectedType == null or selectedType == '' or selectedType == 'EXPENSE'}">
                <option th:each="cat : ${expenseCategories}"
                        th:value="${cat.name()}"
                        th:text="${cat.name()}"
                        th:selected="${selectedCategory == cat.name()}">
                </option>
            </optgroup>
        </select>
    </label>

    <label>Date:
        <input type="date" name="date" th:value="${selectedDate}"/>
    </label>

    <label>Account:
        <select name="account">
            <option value="" th:selected="${selectedAccount == null or selectedAccount == ''}">All</option>
            <option th:each="acc : ${accounts}"
                    th:value="${acc.name}"
                    th:text="${acc.name + ' (' + acc.currency + ')'}"
                    th:selected="${selectedAccount == acc.name}">
            </option>
        </select>
    </label>

    <button type="submit">Filter</button>
</form>

<table border="1" style="margin-top: 10px;">
    <thead>
    <tr>
        <th>Description</th>
        <th>Type</th>
        <th>Category</th>
        <th>Amount</th>
        <th>Date</th>
        <th>Account</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="cashflow : ${cashflows}">
        <td th:text="${cashflow.description}">Description</td>
        <td th:text="${cashflow.type}">Type</td>
        <td th:text="${cashflow.type.name() == 'INCOME' ? cashflow.incomeCategory : cashflow.expenseCategory}">N/A</td>
        <td th:text="${cashflow.amount}">Amount</td>
        <td th:text="${cashflow.date}">Date</td>
        <td th:text="${cashflow.account != null ? cashflow.account.name + ' (' + cashflow.account.currency + ')' : 'N/A'}">Account</td>
        <td>
            <a th:href="@{/cashflow/edit/{id}(id=${cashflow.id})}">Edit</a> |
            <form th:action="@{/cashflow/delete/{id}(id=${cashflow.id})}" method="post" style="display:inline;">
                <button type="submit" onclick="return confirm('Are you sure?')">Delete</button>
            </form>
        </td>
    </tr>
    </tbody>
</table>

<p><strong>Filtered Total Amount:</strong> <span th:text="${filteredTotal}">0</span></p>

<p><a th:href="@{/cashflow/add}">Add New Cashflow</a></p>
<p><a th:href="@{/profile}">‚Üê Back to Profile</a></p>

</body>
</html>
